# Security configuration for VOXAR nginx
# Additional security headers and configurations

# Hide nginx version
server_tokens off;

# Prevent embedding in frames from other domains
add_header X-Frame-Options "SAMEORIGIN" always;

# Prevent MIME type sniffing
add_header X-Content-Type-Options "nosniff" always;

# Enable XSS protection
add_header X-XSS-Protection "1; mode=block" always;

# Control referrer information
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy
add_header Content-Security-Policy "default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https: ws: wss:;" always;

# HTTP Strict Transport Security
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# Additional security headers
add_header X-Permitted-Cross-Domain-Policies "none" always;
add_header X-Download-Options "noopen" always;

# Block common exploit attempts
location ~ /\.(git|svn|hg|bzr|env) {
    deny all;
    return 404;
}

location ~ /\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)$ {
    deny all;
    return 404;
}

# Block access to sensitive files
location ~ /(\.well-known|\.env|composer\.(json|lock)|package\.json|yarn\.lock|webpack\.config\.js) {
    deny all;
    return 404;
}

# Rate limiting for authentication endpoints
location ~ ^/(auth|login|register|forgot|reset) {
    limit_req zone=auth burst=3 nodelay;
    limit_req_status 429;
}