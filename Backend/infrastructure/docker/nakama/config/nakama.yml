name: spatial-ar-platform
data_dir: "/nakama/data"

logger:
  stdout: true
  level: "INFO"
  format: "JSON"

session:
  token_expiry_sec: 7200  # 2 hours
  refresh_token_expiry_sec: 604800  # 7 days
  single_session: false
  encryption_key: "spatial_session_key_2024"

# Socket configuration for WebSocket connections
socket:
  server_key: "spatial_platform_key_2024"
  port: 7349
  address: "0.0.0.0"
  protocol: "tcp"
  max_message_size_bytes: 8192  # Increased for AR data
  read_buffer_size_bytes: 8192
  write_buffer_size_bytes: 8192
  idle_timeout_ms: 120000  # 2 minutes
  write_wait_ms: 5000
  pong_wait_ms: 25000
  ping_period_ms: 15000
  ping_backoff_threshold: 20

# HTTP API configuration 
api:
  port: 7350
  address: "0.0.0.0"
  grpc_gateway_port: 7348  # Explicit gRPC gateway port
  
# Console disabled for production deployment
# Use external monitoring via Grafana on port 3000

# Runtime configuration for Lua modules
runtime:
  http_key: "spatial_http_key_2024"
  read_only_globals: true
  lua_entrypoint: "main.lua"
  js_entrypoint: ""
  path: "/nakama/data/modules"
  
# Performance tracking and metrics
tracker:
  event_queue_size: 16384  # Optimized for platform load
  event_queue_workers: 16  # Increased worker count

# Match engine configuration for AR sessions
match:
  input_queue_size: 2048   # Increased for AR data volume
  call_queue_size: 2048
  join_attempt_queue_size: 2048
  defer_message_fn: ""
  join_marker_deadline_ms: 15000
  max_players: 50  # Maximum players per AR collaborative session
  signal_reservation_ms: 30000

# Database configuration
database:
  address:
    - "nakama-db:5432"
  name: "nakama"
  user: "nakama"
  password: "nakama"
  ssl_mode: "disable"
  conn_max_lifetime_ms: 3600000  # 1 hour
  max_idle_conns: 100     # Optimized for high concurrency
  max_open_conns: 500     # Supports thousands of concurrent users
  query_timeout_ms: 30000
  
# Clustering configuration for horizontal scaling
cluster:
  join: []
  max_message_size_bytes: 8192
  gossip_bindaddr: "0.0.0.0"
  gossip_bindport: 7352
  rpc_port: 7348

# Leaderboard configuration
leaderboard:
  blacklist_rank_cache: []

# Social features
social:
  steam:
    publisher_key: ""
    app_id: 0
  
# Metrics and monitoring
metrics:
  reporting_freq_sec: 60
  stackdriver_projectid: ""
  prometheus_port: 0  # Disabled, using external Prometheus

# Security settings
security:
  cors_origins: ["*"]  # Configure for production domains
  signing_key: "spatial_platform_signing_key_2024"